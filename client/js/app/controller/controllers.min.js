app.controller("inventoryController",["$scope","$http",function(a,b){a.title="Inventory";var c=function(a){return a.name?isNaN(a.price)?"Product price should be a number!":a.price<0?"Product price should be 0 or more!":"":"Product name cannot be empty!"};a.init=function(){var a="/api/Products",d="bootstrap",e={datatype:"json",datafields:[{name:"id",type:"int"},{name:"name",type:"string"},{name:"price",type:"int"}],addrow:function(a,d,e,f){d.id=null;var g=c(d);g?$.notify(g,"warn"):b.post("/api/Products",d).then(function(a){f(!0,a.data.id),$.notify("Product added successfully!!","success")},function(a){console.log(a),$.notify("Ohh snap!! Something went wrong!","error"),f(!1)})},updaterow:function(a,d,e){var f=c(d);f?$.notify(f,"warn"):b.put("/api/Products/"+a,d).then(function(a){e(!0),$.notify("Product updated successfully!!","success")},function(a){console.log(a),$.notify("Ohh snap!! Something went wrong!","error"),e(!1)})},deleterow:function(a,c){b.delete("/api/Products/"+a).then(function(a){c(!0),$.notify("Product deleted successfully!!","success")},function(a){console.log(a),$.notify("Ohh snap!! Something went wrong!","error"),c(!1)})},id:"id",url:a};$("#name").jqxInput({theme:d}),$("#price").jqxInput({theme:d}),$("#name").width(150),$("#name").height(23),$("#price").width(150),$("#price").height(23);var f=-1,g=new $.jqx.dataAdapter(e);$("#jqxgrid").jqxGrid({theme:"bootstrap",width:"100%",height:"480px",source:g,pageable:!0,sortable:!0,filterable:!0,showfilterrow:!0,altrows:!0,enabletooltips:!0,showeverpresentrow:!0,everpresentrowposition:"top",selectionmode:"multiplecellsadvanced",editable:!0,columns:[{text:"Id",datafield:"id",width:"20%"},{text:"Name",datafield:"name",width:"40%"},{text:"Price",datafield:"price",width:"40%"}]}),$("#jqxgrid").on("rowdoubleclick",function(a){f=a.args.rowindex;var b=$("#jqxgrid").offset();$("#popupWindow").jqxWindow({position:{x:parseInt(b.left)+60,y:parseInt(b.top)+60}});var c=$("#jqxgrid").jqxGrid("getrowdata",f);$("#name").val(c.name),$("#price").val(c.price),$("#popupWindow").jqxWindow("open")}),$("#popupWindow").jqxWindow({width:250,resizable:!1,isModal:!0,autoOpen:!1,cancelButton:$("#Cancel"),modalOpacity:.01}),$("#popupWindow").on("open",function(){$("#name").jqxInput("selectAll")}),$("#Cancel").jqxButton({theme:d}),$("#Save").jqxButton({theme:d}),$("#Delete").jqxButton({theme:d}),$("#Save").click(function(){if(f>=0){var a={name:$("#name").val(),price:$("#price").val()},b=$("#jqxgrid").jqxGrid("getrowid",f);$("#jqxgrid").jqxGrid("updaterow",b,a),$("#popupWindow").jqxWindow("hide")}}),$("#Delete").click(function(){if(f>=0){var b=({name:$("#name").val(),price:$("#price").val()},$("#jqxgrid").jqxGrid("getrowid",f));$("#jqxgrid").jqxGrid("deleterow",b),$("#popupWindow").jqxWindow("hide")}})},angular.element(document).ready(function(){a.init()})}]),app.controller("loginController",["$scope","localStorageService","$window","$http","$rootScope","$timeout","$location",function(a,b,c,d,e,f,g){console.log("Inside loginController"),a.user={email:"",password:""},a.login=function(){console.log("email-->"+a.user.email+" password-->"+a.user.password),d.post("/api/People/login",a.user).then(function(c){console.log("Success login"),b.set("email",a.user.email),b.set("accessTokenId",c.data.id),b.set("id",c.data.userId),e.currentUserId=c.data.userId,d.defaults.headers.common.Authorization=c.data.id,g.path("/sales")},function(a){console.log("Error login"),$.notify("Ohh snap!! Something went wrong!","error")})}}]),app.controller("mainController",["$scope","localStorageService","$http","$rootScope","$location",function(a,b,c,d,e){a.accessToken={access_token:""},a.accessToken.access_token=b.get("accessTokenId"),a.logOut=function(){c.post("/api/People/logout",a.accessToken).then(function(a){console.log("Success logout"),b.set("email",""),b.set("accessTokenId",""),b.set("id","")},function(a){console.log("Error logout"),$.notify("Ohh snap!! Something went wrong!","error")})}}]),app.controller("salesController",["$scope","$timeout","$http","LocalStorage","DEFAULT_INVOICE","DEFAULT_LOGO",function(a,b,c,d,e,f){a.title="Sales",a.checkWhetherItemExistsInProducts=function(b){for(var c=!1,d=0;d<a.products.length;d++)if(a.products[d].id==b.id&&a.products[d].name==b.name){c=!0;break}return c};var g=function(a){for(var b=0;b<a.length;b++){var c=a[b];if(isNaN(c.quantity))return""+c.productName+" should have a numeric quantity!";if(c.quantity<1)return""+c.productName+" should have more than 0 quantity!";if(isNaN(c.unitPrice))return""+c.productName+" should have a numeric price!";if(c.unitPrice<0)return""+c.productName+" price should be 0 or more!"}if(!a.length)return"invoice should have some items!"};a.getProductsFromServer=function(){c.get("/api/Products").then(function(b){a.products=b.data},function(a){$.notify("Ohh snap!! Something went wrong while fetching latest Products!","error"),console.log(a)})},a.getNextInvoiceNumber=function(){c.get("/api/Invoices/count").then(function(b){a.invoice.id=b.data.count+1},function(a){$.notify("Ohh snap!! Something went wrong while fetching new invoice id!","error"),console.log(a)})},a.pageLoadOrReload=function(){a.getProductsFromServer();var b=d.getInvoice();a.invoice=b?b:e,b||(a.getNextInvoiceNumber(),a.invoice.items=[])},a.$on("$destroy",function(){a.invoice.items.length?d.setInvoice(a.invoice):d.clear()}),a.onNewInvoice=function(){d.clear(),a.printMode=!1,a.setInvoice(e),a.invoice.items=[],a.getNextInvoiceNumber()},a.onResetInvoice=function(){d.clear(),a.invoice.items=[],a.printMode=!1},a.onSaveInvoice=function(){var b=confirm("Are you sure you would like to save the invoice?");b&&(d.setInvoice(a.invoice),a.saveInvoiceToServer(a.invoice,!1))},a.onSaveAndPrintInvoice=function(){var b=confirm("Are you sure you would like to save the invoice?");b&&(d.setInvoice(a.invoice),a.saveInvoiceToServer(a.invoice,!0))},a.saveInvoiceToServer=function(d,e){for(var f={quantity:d.quantity,totalPrice:d.totalPrice,date:d.date},h=[],i=0;i<d.items.length;i++){var j={invoiceId:d.id,productId:d.items[i].id,productName:d.items[i].name,unitPrice:d.items[i].price,quantity:d.items[i].qty,totalPrice:d.items[i].price*d.items[i].qty,date:d.date};h.push(j)}var k=g(h);k?$.notify(k,"warn"):c.post("/api/Invoices",f).then(function(a){console.log("Invoice saved successfully!!"),saveInvoiceItemsToServer(h,e)},function(a){console.log("error in saving invoice"),$.notify("Ohh snap!! Something went wrong!","error")}),saveInvoiceItemsToServer=function(d,e){c.post("/api/InvoiceItems",d).then(function(c){console.log("Success in saving invoice"),$.notify("Invoice saved successfully!","success"),a.printMode=!0,e&&($(".notifyjs-wrapper").trigger("notify-hide"),b(window.print(),100))},function(a){console.log("error in saving invoice"),$.notify("Ohh snap!! Something went wrong!","error")})}};a.saveInvoice={quantity:0,totalPrice:0,date:"2016-11-27",items:[{invoiceId:0,productId:0,productName:"string",unitPrice:0,quantity:0,totalPrice:0,date:"2016-11-27",id:0}]},a.calculateTotalNumberOfItems=function(){var b=0;return angular.forEach(a.invoice.items,function(a,c){b+=parseInt(a.qty)}),a.invoice.quantity=b,b},a.itemToBeEntered={qty:1},a.selectedId=function(b){console.log(b),b&&(a.itemToBeEntered.id=b.originalObject.id,a.itemToBeEntered.price=b.originalObject.price,a.itemToBeEntered.name=b.originalObject.name)},a.selectedName=function(b){console.log(b),b&&(a.itemToBeEntered.id=b.originalObject.id,a.itemToBeEntered.price=b.originalObject.price,a.itemToBeEntered.name=b.originalObject.name)},a.enterKeyPressed=function(b){console.log("Enter key pressed"),a.checkWhetherItemExistsInProducts(b)?a.addItem(b):$.notify("This item doesnot exist in Inventory table. Please update your inventory first!","warn")},function(){!function(){a.pageLoadOrReload()}(),!function(){var b=d.getLogo();a.logo=b?b:f}(),a.availableCurrencies=[]}(),a.addItem=function(b){var c=new Object({id:b.id,name:b.name,qty:b.qty,price:b.price});(!c.name||c.name.length<=0)&&(c.name=$("#nameAutocomplete_value").val()),a.invoice.items.push(c),a.$broadcast("angucomplete-alt:clearInput"),a.itemToBeEntered={qty:1}},a.removeItem=function(b){a.invoice.items.splice(a.invoice.items.indexOf(b),1)},a.invoiceSubTotal=function(){var b=0;return angular.forEach(a.invoice.items,function(a,c){b+=a.qty*a.price}),b},a.calculateTax=function(){return a.invoice.tax*a.invoiceSubTotal()/100},a.calculateGrandTotal=function(){return a.invoice.totalPrice=a.calculateTax()+a.invoiceSubTotal(),a.invoice.totalPrice},a.setInvoice=function(b){a.invoice=b,c.get("/api/Invoices/count").then(function(b){a.invoice.invoice_number=b.data.count+1},function(a){console.error("Error setting invoice number:"),console.log(a)})},angular.element(document).ready(function(){$("#idAutocomplete_value").css("width","90%")})}]),app.controller("salesHistoryController",["$scope","$http",function(a,b){a.title="Sales History",a.init=function(){var a="/api/Invoices",c={datatype:"json",datafields:[{name:"id",type:"int"},{name:"date",type:"date"},{name:"quantity",type:"int"},{name:"totalPrice",type:"float"}],id:"id",url:a},d=new $.jqx.dataAdapter(c);$("#jqxgrid").jqxGrid({theme:"bootstrap",width:"100%",height:"480px",source:d,pageable:!0,sortable:!0,filterable:!0,showfilterrow:!0,altrows:!0,enabletooltips:!0,selectionmode:"singlerow",columns:[{text:"Invoice Number",datafield:"id",width:"10%"},{text:"Date",datafield:"date",width:"30%",filtertype:"range",cellsformat:"d"},{text:"Quantity",datafield:"quantity",width:"20%"},{text:"Total Price",datafield:"totalPrice",width:"40%"}]}),$("#jqxgrid").on("rowdoubleclick",function(a){})},angular.element(document).ready(function(){a.init()})}]),app.controller("salesReportController",["$scope","$http",function(a,b){a.title="Sales Report",a.init=function(){var a="/api/InvoiceItems",b={datatype:"json",datafields:[{name:"invoiceId",type:"number"},{name:"productName",type:"string"},{name:"date",type:"date"},{name:"range",map:"date",type:"date"},{name:"unitPrice",type:"number"},{name:"quantity",type:"number"},{name:"totalPrice",type:"number"}],url:a},c=new $.jqx.dataAdapter(b);$("#jqxgrid").jqxGrid({width:"100%",height:"480px",source:c,showfilterrow:!0,filterable:!0,groupable:!0,showgroupaggregates:!0,showaggregates:!0,selectionmode:"multiplecellsextended",columns:[{text:"Invoice Id",datafield:"invoiceId",width:"5%"},{text:"Product",datafield:"productName",width:"15%"},{text:"Sales Date",datafield:"date",width:"10%",cellsalign:"right",cellsformat:"d"},{text:"Range",datafield:"range",filtertype:"range",cellsalign:"right",width:"30%",cellsformat:"d"},{text:"Unit Price",datafield:"unitPrice",cellsalign:"right",width:"15%"},{text:"Quantity",datafield:"quantity",aggregates:["sum"],cellsalign:"right",width:"10%"},{text:"Total Price",datafield:"totalPrice",aggregates:["sum"],cellsalign:"right",width:"15%"}]}),$("#jqxgrid").on("groupschanged",function(){$("#jqxgrid").jqxGrid("clearfilters")}),$("#clearfilteringbutton").jqxButton({height:25}),$("#clearfilteringbutton").click(function(){$("#jqxgrid").jqxGrid("clearfilters")})},angular.element(document).ready(function(){a.init()})}]),app.controller("welcomeController",["$scope",function(a){a.title="Welcome to the Bakery"}]);